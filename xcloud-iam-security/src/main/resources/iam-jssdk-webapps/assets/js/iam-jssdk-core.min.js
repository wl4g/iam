(function(n,p){var l={resources:{loading:"data:image/gif;base64,R0lGODlhHgAeAPf/AGzI8iqM4ev4/YnU9YrR9HLK8le67+f2/Knf94zU9ZLV9nbK8vr9/uP1/fL7/k+57mTC8TCm6TOp6t/0/WG+8GPE8FO98HvH8rbj+LLi+JzX9mjE8czq+k2679Pu+yqI4Tar637L8z+y7fT7/s7s+8zt+zCg53jM83HJ8vf7/uv3/d7z/M3s+i+g6MLn+bTj+KPe95HV9Uy57j2x7dHu+4HP9DCm6S2b5iyV5SyW5S2Y5SyW5C6c5i2Z5i2X5S6e5zGn6S6f5yyV5C2Z5S2a5iyS4/b8/iyU5C6d5y+l6S+k6IPO8y6d5vT7/lW98GrH8S+j6C+i6C+h6P7///z+/yuQ4/X7/v3+/2zG8UK07cXq+i6e5vL6/drx/CuR45DW9dTw/O75/fH6/YjS9fn9/l7A77bj+Tiu62zD8dfx/IbP9C+k6XfN81zA7yyT5Nbw/EK27tv0/b/m+e/5/p/b93zK8kCy7C2b5TKn6r7n+fb9/vz//4XQ9GfG8I7T9XbL85XX9svr+km07cbp+tvx/MDo+oDQ9E257qXd+Pf9/t7z/XjK8pPX9tfw/D6s673m+SyT43/P9LPl+X3L8zKn6S2a5X/O84HP8+Dz/YHO9Jva9yuP4k237lu/7zCj6fz9/jer6srr+rfj+a3f963h97/n+WnF8Fa88NXu+2/J8vn9/4jS9F/C8JLV9ZLW9VzB70257qLd+HXK8jGn6pzZ9t3y/ILP9O34/S2a5aDe+GLB777m+XHI8fX8/4vS9afc9y6d53XL82/H8oHN8/v+/37J8v3//1a98JLX9lq/72fA74XP84XR9IfR9J3a9/D5/dfv/F2/8VK779vy/C6c5rzl+bvm+XbI8pvc9l7B8C+h6C6e6Eaw7Ea17ZbZ9zOd5pfX9UOy7L7n+i6a5S2Y5ZTV9p/a9y6h5/T8/tDu+8fp+uD0/c/u+57b99jx/L3o+SyS5JDU9ZvY9tLy/LXi9zeu633I8vf+/7Dh90Cv66Hd95zZ95za9i6f6P///////yH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkIyQjlEMzRFOEY2QzExRTU5MzVCODg0NzA4NjRDMDNCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkIyQjlEMzRGOEY2QzExRTU5MzVCODg0NzA4NjRDMDNCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QjJCOUQzNEM4RjZDMTFFNTkzNUI4ODQ3MDg2NEMwM0IiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QjJCOUQzNEQ4RjZDMTFFNTkzNUI4ODQ3MDg2NEMwM0IiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0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"},
iamVerboseStoredKey:"__IAM_VERBOSE",umidTokenStorageKey:"__IAM_UMIDTOKEN",authRedirectRecordStorageKey:"__IAM_AUTHC_REDIRECT_RECORD",useSecureAlgorithmName:"RSA"};n.IAMCore=function(a){var b=this;this.getIamBaseUri=function(){var a=location.protocol,d=location.hostname,e=b.settings.deploy.defaultServerPort,g=b.settings.deploy.defaultTwoDomain,f=b.settings.deploy.defaultContextPath,f=f.startsWith("/")?f:"/"+f;if(Common.Util.isIp(d)||"localhost"==d||"127.0.0.1"==d||d.endsWith(".debug")||d.endsWith(".local")||
d.endsWith(".dev"))return a+"//"+d+":"+e+f;d=Common.Util.extTopDomainString(d);return a+"//"+g+"."+d+f};this.runtime={umid:{_value:null,getValue:function(){return Common.Util.checkEmpty("Fatal error, umidToken value is null, No attention to call order (must be executed after that.runtime.umid.getValuePromise())",b.runtime.umid._value)},_currentlyInGettingValuePromise:null,getValuePromise:function(){if(b.runtime.umid._currentlyInGettingValuePromise)return b.runtime.umid._currentlyInGettingValuePromise;
var a=Common.Util.Codec.decodeBase58(sessionStorage.getItem(l.umidTokenStorageKey));return Common.Util.isEmpty(a)?b.runtime.umid._currentlyInGettingValuePromise=new Promise(function(a,c){IamFingerprint.getFingerprint({},function(d){var f=new Map;f.set("userAgent",d.components.get("userAgent"));f.set("platform",d.components.get("platform"));f.set("pixelRatio",d.components.get("pixelRatio"));f.set("timezone",d.components.get("timezone"));f.set("language",d.components.get("language"));f.set("cpuClass",
d.components.get("cpuClass"));f.set("touchSupport",d.components.get("touchSupport"));f.set("deviceMemory",d.components.get("deviceMemory"));f.set("availableScreenResolution",d.components.get("availableScreenResolution"));f.set("canvas",CryptoJS.MD5(d.components.get("canvas")).toString(CryptoJS.enc.Hex));f.set("webgl",CryptoJS.MD5(d.components.get("webgl")).toString(CryptoJS.enc.Hex));f.set("indexedDb",d.components.get("indexedDb"));f.set("sessionStorage",d.components.get("sessionStorage"));f.set("localStorage",
d.components.get("localStorage"));f.set("colorDepth",d.components.get("colorDepth"));d=new Map;for(var e=Common.Util.toUrl({},f),f=100+parseInt(100*Math.random()),g=parseInt(f%3+1),h=0;h<g;h++)e=Common.Util.Codec.encodeBase58(e);e=f+"!"+e;IAMCore.Console.debug("Generated apply umidToken data: "+e);d.set("umdata",e);b._doIamRequest("post","{applyUmTokenUri}",d,function(c){Common.Util.checkEmpty("init.onPostUmidToken",b.settings.init.onPostUmidToken)(c);var d=Common.Util.checkEmpty("definition.codeOkValue",
b.settings.definition.codeOkValue);Common.Util.isEmpty(c)||c.code!=d||(IAMCore.Console.debug("Got umidToken: "+c.data.umidToken),d=Common.Util.Codec.encodeBase58(c.data.umidToken),sessionStorage.setItem(l.umidTokenStorageKey,d),a(c.data.umidToken),b.runtime.umid._value=c.data.umidToken);b.runtime.umid._currentlyInGettingValuePromise=null},function(a){b.runtime.umid._currentlyInGettingValuePromise=null;console.warn("Failed to gets umidToken, "+a);Common.Util.checkEmpty("init.onError",b.settings.init.onError)(a);
c(a)},null,!1)})}):(b.runtime.umid._value=a,new Promise(function(b,c){return b(a)}))}},handshake:{_value:null,getValue:function(){return Common.Util.checkEmpty("Fatal error, handshake value is null, No attention to call order (must be executed after that.runtime.handshake.getValuePromise())",b.runtime.handshake._value)},_currentlyInGettingValuePromise:null,getValuePromise:function(a,d){if(!d){if(b.runtime.handshake._currentlyInGettingValuePromise)return b.runtime.handshake._currentlyInGettingValuePromise;
if(!Common.Util.isEmpty(b.runtime.handshake._value))return new Promise(function(a,c){return a(b.runtime.handshake._value)})}return b.runtime.handshake._currentlyInGettingValuePromise=new Promise(function(c,d){d=new Map;d.set("{umidTokenKey}",Common.Util.checkEmpty("umidToken",a));b._doIamRequest("post","{handshakeUri}",d,function(a){Common.Util.checkEmpty("init.onPostHandshake",b.settings.init.onPostHandshake)(a);var d=Common.Util.checkEmpty("definition.codeOkValue",b.settings.definition.codeOkValue);
Common.Util.isEmpty(a)||a.code!=d||(b.runtime.handshake._value=$.extend(!0,b.runtime.handshake._value,a.data),c(a));b.runtime.handshake._currentlyInGettingValuePromise=null},function(a){b.runtime.handshake._currentlyInGettingValuePromise=null;IAMCore.Console.log("Failed to handshake, "+a);Common.Util.checkEmpty("init.onError",b.settings.init.onError)(a)},null,!1)})},handleSessionTo:function(a){Common.Util.isAnyEmpty(b.runtime.handshake._value.session.sk,b.runtime.handshake._value.session.sv)||(Common.Util.isObject(a)?
a[b.runtime.handshake._value.session.sk]=b.runtime.handshake._value.session.sv:Common.Util.isMap(a)&&a.set(b.runtime.handshake._value.session.sk,b.runtime.handshake._value.session.sv))},handleChooseSecureAlg:function(){var a=b.runtime.handshake.getValue().algs,d;for(d in a)if(Common.Util.Codec.decodeBase58(a[d]).startsWith(l.useSecureAlgorithmName))return a[d];throw Error("No such secure algoritm of: "+l.useSecureAlgorithmName);}},safeCheck:{checkGeneric:{secretKey:null},checkCaptcha:{enabled:!1,
support:null,applyUri:null},checkSms:{enabled:!1,mobileNum:null,remainDelayMs:null}},clientSecretKey:{},applyModel:{primaryImg:null,applyToken:null,verifyType:null},verifiedModel:{verified:!0,verifiedToken:null},flags:{isCurrentlyApplying:!1,isVerifying:!1}};this._defaultCaptchaVerifier={captchaLen:5,captchaDestroy:function(a){var c=Common.Util.checkEmpty("captcha.input",b.settings.captcha.input),e=Common.Util.checkEmpty("captcha.img",b.settings.captcha.img);$(e).unbind("click");$(e).attr({src:"./static/images/ok.png"});
$(c).attr("disabled",!0);$(c).css({cursor:"context-menu"});a&&($(c).val(""),$(c).css({display:"none"}),$(e).attr({src:""}),$(e).css({display:"none"}))},captchaRender:function(){b.runtime.flags.isCurrentlyApplying=!1;var a=$(Common.Util.checkEmpty("captcha.input",b.settings.captcha.input)),d=Common.Util.checkEmpty("captcha.img",b.settings.captcha.img);a.val("");$(d).click(function(){b._resetCaptcha(!0)});b._doIamRequest("get",b._getApplyCaptchaUrl(b),new Map,function(c){b.runtime.flags.isCurrentlyApplying=
!1;b.runtime.applyModel=c.data.applyModel;$(a).css({display:"none",cursor:"text"});$(a).removeAttr("disabled");$(d).css({display:"none"});var e=Common.Util.checkEmpty("definition.codeOkValue",b.settings.definition.codeOkValue);Common.Util.isEmpty(c)||c.code!=e?($(d).attr("title",c.message),$(d).unbind("click"),setTimeout(function(){$(d).click(function(){b._resetCaptcha(!0)})},15E3)):$(d).attr("src",c.data.applyModel.primaryImg)},function(a,c,d){IAMCore.Console.error("Failed to apply captcha, "+d);
Common.Util.checkEmpty("captcha.onError",b.settings.captcha.onError)(d)},null,!0)}};this.settings={definition:{codeOkValue:"200",code401Value:"401",statusUnauthenticatedValue:"Unauthenticated",responseType:"response_type",responseTypeValue:"json",whichKey:"which",redirectUrlKey:"redirect_url",refreshUrlKey:"refresh_url",principalKey:"principal",credentialKey:"credential",clientSecretKey:"clientSecretKey",verifyTypeKey:"verifyType",applyTokenKey:"applyToken",verifyDataKey:"verifyData",verifiedTokenKey:"verifiedToken",
clientRefKey:"client_ref",umidTokenKey:"umidToken",secureAlgKey:"alg",smsActionKey:"action",smsActionValueLogin:"login",applyUmTokenUri:"/rcm/applyumtoken",handshakeUri:"/login/handshake",checkUri:"/login/check",captchaApplyUri:"/verify/applycaptcha",verifyAnalyzeUri:"/verify/verifyanalysis",accountSubmitUri:"/auth/generic",smsApplyUri:"/verify/applysmsverify",smsSubmitUri:"/auth/sms",snsConnectUri:"/sns/connect/",applyXsrfTokenUrlKey:"/xsrf/xtoken",xsrfTokenHeaderKey:"X-Iam-Xsrf-Token",xsrfTokenParamKey:"_xsrf",
replayTokenHeaderKey:"X-Iam-Replay-Token",replayTokenParamKey:"_replayToken"},deploy:{baseUri:null,defaultTwoDomain:"iam",defaultServerPort:18080,defaultContextPath:"/iam-web"},init:{onPostUmidToken:function(a){IAMCore.Console.debug("onPostUmidToken... "+a)},onPostHandshake:function(a){IAMCore.Console.debug("onPostHandshake... ",a)},onPreCheck:function(a){IAMCore.Console.debug("onPreCheck... principal:"+a);return!0},onPostCheck:function(a){IAMCore.Console.debug("onPostCheck... "+a)},onError:function(a){console.error("Failed to initialize... "+
a)}},captcha:{enable:!1,use:"VerifyWithGifGraph",panel:null,img:null,input:null,getVerifier:function(){var a=Common.Util.checkEmpty("captcha.use",b.settings.captcha.use),d=Common.Util.checkEmpty("captcha.registry",b.settings.captcha.registry),e;for(e in d)if(e==a)return d[e];throw"Illegal verifier type for '"+e+"'";},registry:{VerifyWithSimpleGraph:b._defaultCaptchaVerifier,VerifyWithGifGraph:b._defaultCaptchaVerifier,VerifyWithJigsawGraph:{captchaDestroy:function(a){var c=Common.Util.checkEmpty("captcha.panel",
b.settings.captcha.panel);a&&$(c).css({display:"none"})},captchaRender:function(){b.runtime.flags.isCurrentlyApplying=!1;var a=Common.Util.checkEmpty("captcha.panel",b.settings.captcha.panel);$(a).JigsawIamCaptcha(b,{verifyDataKey:Common.Util.checkEmpty("definition.verifyDataKey",b.settings.definition.verifyDataKey),getApplyCaptchaUrl:b._getApplyCaptchaUrl,getVerifyAnalysisUrl:b._getVerifyAnalysisUrl,repeatIcon:"fa fa-redo",onSuccess:function(a){IAMCore.Console.debug("Jigsaw captcha verify successful. verifiedToken is '"+
a+"'");b.runtime.flags.isCurrentlyApplying=!1;b.runtime.verifiedModel.verifiedToken=a;Common.Util.checkEmpty("captcha.onSuccess",b.settings.captcha.onSuccess)(a)},onFail:function(a){IAMCore.Console.debug("Failed to jigsaw captcha verify. element \x3d\x3e "+a);b.runtime.flags.isCurrentlyApplying=!1;b.runtime.verifiedModel.verifiedToken="";Common.Util.checkEmpty("captcha.onError",b.settings.captcha.onError)(a)}})}}},onSuccess:function(a){IAMCore.Console.debug("Jigsaw captcha verify successfully. verifiedToken is '"+
a+"'")},onError:function(a){console.error("Failed to jigsaw captcha verify. "+a)}},account:{enable:!1,submitBtn:null,principalInput:null,credentialInput:null,customParamMap:new Map,onBeforeSubmit:function(a,b,e){IAMCore.Console.debug("Prepare to submit login request. principal\x3d"+a+", verifiedToken\x3d"+e);return!0},onSuccess:function(a,b){IAMCore.Console.info("Sign in successfully. "+b.principal+", "+b.redirectUrl);return!0},onError:function(a){console.error("Sign in error. "+a)}},sms:{enable:!1,
submitBtn:null,sendSmsBtn:null,mobileArea:null,mobile:null,onBeforeSubmit:function(a,b){IAMCore.Console.log("Prepare to submit SMS login request. mobileNum\x3d"+a+", smsCode\x3d"+b);return!0},onSuccess:function(a){IAMCore.Console.log("SMS success. "+a.message)},onError:function(a){throw"SMS login error. "+a;}},sns:{enable:!1,required:{getWhich:function(a,b){throw"Unsupported errors, please implement to support get which function";},refreshUrl:null},getPrincipal:function(){},qrcodePanel:null,pagePanel:null,
provider:null,onBefore:function(a,b,e){}}};this._initConfigure(a)};n.IAMCore.Console={_isVerbose:function(){var a=sessionStorage.getItem(l.iamVerboseStoredKey);return a?(a=a.toUpperCase(),"TRUE"==a||"1"==a||"Y"==a||"YES"==a):!1},_doLog:function(a,b){if(IAMCore.Console._isVerbose()){var c=(new Date).format("[yyyy-MM-dd hh:mm:ss.S]")+" "+a+" --- ",d=[];d.push(c);for(var e in b)d.push(b[e]);switch(a){case "TRACE":console.trace.apply(console,d);break;case "DEBUG":console.debug.apply(console,d);break;
case "INFO":console.info.apply(console,d);break;case "WARN":console.warn.apply(console,d);break;case "ERROR":console.error.apply(console,d);break;default:console.log.apply(console,d)}}},trace:function(){IAMCore.Console._doLog("TRACE",arguments)},debug:function(){IAMCore.Console._doLog("DEBUG",arguments)},info:function(){IAMCore.Console._doLog("INFO",arguments)},warn:function(){IAMCore.Console._doLog("WARN",arguments)},error:function(){IAMCore.Console._doLog("ERROR",arguments)},log:function(){IAMCore.Console._doLog("INFO",
arguments)}};IAMCore.prototype._initConfigure=function(a){a!==this.settings&&(this.settings=$.extend(!0,this.settings,a),IAMCore.Console.debug("Merged IAM core settings: ",this.settings),this.settings.deploy.baseUri=this.getIamBaseUri(),IAMCore.Console.info("Use overlay IAM baseUri: ",this.settings.deploy.baseUri))};IAMCore.prototype.checkRespUnauthenticated=function(a){if(a){var b=a.status&&a.status==this.settings.definition.statusUnauthenticatedValue;return a.code&&(a.code==this.settings.definition.code401Value||
a.code+""==this.settings.definition.code401Value)||b}return!1};IAMCore.prototype.checkRespSuccess=function(a){return a.code==this.settings.definition.code401Value||a.code+""==this.settings.definition.code401Value?!0:!1};IAMCore.prototype._multiModularAuthenticatingHandler=function(){var a=this;return{isRedirectingLogin:!1,mutexControllerManager:new Map,doMultiModularRequest:function(b,c,d,e,g,f){a._doIamRequest(b,"@"+c,d||{},e,g,f,!1)},checkTGCExpiredAndRedirectToLogin:function(b,c){var d=a._multiModularAuthenticatingHandler();
IAMCore.Console.debug("TGC validating... res: ",b);return a.checkRespUnauthenticated(b)&&b.data&&"IamWithCasAppServer"==b.data.serviceRole?(IAMCore.Console.info("TGC expired, redirectTo: ",b.data[a.settings.definition.redirectUrlKey],"isRedirectingLogin: ",d.isRedirectingLogin),c&&!d.isRedirectingLogin&&(d.isRedirectingLogin=!0,c(b)),!0):!1},getMutexController:function(b){var c=a._multiModularAuthenticatingHandler(),d=null;b.toUpperCase().startsWith("HTTP://")?(b=new URL(b),d=b.protocol+"://"+b.host):
d=location.origin+"//"+b;var e=c.mutexControllerManager.get(d);e||c.mutexControllerManager.set(d,e={_cache_auth_state:{state:!1,time:0},urlSame:d,currentlyInAuthenticatingState:!1,requestQueue:[],authenticated:function(a){var b=e._cache_auth_state;if(a)b.state=a,b.time=(new Date).getTime();else return b.state&&1E4>Math.abs((new Date).getTime()-b.time)}});return e},doHandle:function(b,c,d,e,g,f,k){var m=a._multiModularAuthenticatingHandler();Common.Util.checkEmpty("multiModularAuthenticatingRequest.res",
b);Common.Util.checkEmpty("multiModularAuthenticatingRequest.method",c);Common.Util.checkEmpty("multiModularAuthenticatingRequest.url",d);Common.Util.checkEmpty("multiModularAuthenticatingRequest.redirectFn",k);if(a.checkRespUnauthenticated(b)){var h=m.getMutexController(d);if(h.currentlyInAuthenticatingState){var q={res:b,method:c,url:d,successFn:e,errorFn:g,params:f};h.requestQueue.push(q);IAMCore.Console.info("Offered authenticating authRequest: ",q,", requestQueue: ",h.requestQueue)}else h.currentlyInAuthenticatingState=
!0,(new Promise(function(a,d){IAMCore.Console.info("Biz unauth response: ",b);h.authenticated()?a():m.checkTGCExpiredAndRedirectToLogin(b,k)||(b.data&&b.data.redirect_url?m.doMultiModularRequest(c,b.data.redirect_url,null,a,g,null):g(b))})).then(function(a){IAMCore.Console.info("Iam-server response: ",a);if(!h.authenticated()&&!m.checkTGCExpiredAndRedirectToLogin(a,k)){if(a.data&&a.data.redirect_url)return new Promise(function(b,c){m.doMultiModularRequest("get",a.data.redirect_url,null,b,g,null)});
g&&g(a)}}).then(function(b){IAMCore.Console.info("Iam-client response: ",b);h.currentlyInAuthenticatingState=!1;m.doMultiModularRequest(c,d,f,function(b){IAMCore.Console.info("Redirect origin biz response: ",b);a.checkRespUnauthenticated(b)?h.authenticated(!1):(e&&e(b),h.authenticated(!0))},function(a){g?g(a):IAMCore.Console.error(a)},function(){if(0<h.requestQueue.length){var a=h.requestQueue[0];h.requestQueue.splice(0,1);IAMCore.Console.info("Poll authenticating queue first: ",a,", requestQueue: ",
h.requestQueue);m.doHandle(a.res,a.method,a.url,a.successFn,a.errorFn,a.params,k)}})})}else IAMCore.Console.debug("Ignore authenticated of url: ",d,", res: ",b)}}};IAMCore.prototype.getXsrfToken=function(a){var b=Common.Util.checkEmpty("definition.xsrfTokenHeaderKey",this.settings.definition.xsrfTokenHeaderKey),c=Common.Util.checkEmpty("definition.xsrfTokenParamKey",this.settings.definition.xsrfTokenParamKey),d=function(a,b,c){a={headerName:a,paramName:b,value:c};IAMCore.Console.debug("Got xsrfToken:",
a);return a},e=location.hostname,g=Common.Util.extTopDomainString(e),f=e,g=e.indexOf(g);0<g&&(f=e.substring(0,g-1));var f=f.replace(".","_").toUpperCase(),k="IAM-"+f+"-XSRF-TOKEN",m=Common.Util.getCookie(k,null);IAMCore.Console.debug("Loaded cache xsrfTokenValue:",m,"by cookieName:",k);var h=!a;m||(IAMCore.Console.debug("Loading new xsrf token..."),e=(new IAMCore(this.settings)).getIamBaseUri()+Common.Util.checkEmpty("definition.applyXsrfTokenUrlKey",this.settings.definition.applyXsrfTokenUrlKey),
Common.Util.Http.request({url:e,type:"HEAD",async:!h,xhrFields:{withCredentials:!0},success:function(e,f,g){m=Common.Util.getCookie(k);IAMCore.Console.info("Loaded new xsrfTokenValue:",m,"by cookieName:",k);h||a(d(b,c,m))},error:function(a,b,c){IAMCore.Console.error("Failed to init xsrf token. "+c)}}));if(h)return d(b,c,Common.Util.getCookie(k))};IAMCore.prototype.generateReplayToken=function(){for(var a=(new Date).getTime(),b="",c=0;2>c;c++)b+=Math.random().toString(36).substr(2);for(var c=Common.Util.sortWithAscii(b+
a),d=Common.Util.Crc16CheckSum.crc16Modbus(c),d=parseInt(d%c.length/Math.PI)+1,e=c,c=0;c<d;c++)e=CryptoJS.MD5(e).toString(CryptoJS.enc.Hex);c=JSON.stringify({n:b,t:a,s:e});a=Common.Util.checkEmpty("definition.replayTokenHeaderKey",this.settings.definition.replayTokenHeaderKey);b=Common.Util.checkEmpty("definition.replayTokenParamKey",this.settings.definition.replayTokenParamKey);d=Common.Util.Codec.encodeBase58(c);IAMCore.Console.debug("Generated replay token(plain): ",c," - ",d);return{headerName:a,
paramName:b,value:d}};IAMCore.prototype._getSnsConnectUrl=function(a,b){var c=Common.Util.checkEmpty("sns.required",this.settings.sns.required),c=Common.Util.checkEmpty("required.getWhich",c.getWhich(a,b));a=this.settings.deploy.baseUri+Common.Util.checkEmpty("definition.snsConnectUri",this.settings.definition.snsConnectUri)+Common.Util.checkEmpty("provider",a)+"?"+Common.Util.checkEmpty("definition.whichKey",this.settings.definition.whichKey)+"\x3d"+c;if("bind"==c.toLowerCase()||"unbind"==c.toLowerCase()){var c=
encodeURIComponent(Common.Util.checkEmpty("sns.principal",this.settings.sns.getPrincipal())),d=encodeURIComponent(Common.Util.checkEmpty("sns.required.refreshUrl",this.settings.sns.required.refreshUrl));a+="\x26"+Common.Util.checkEmpty("definition.principalKey",this.settings.definition.principalKey)+"\x3d"+c;a+="\x26"+Common.Util.checkEmpty("definition.refreshUrlKey",this.settings.definition.refreshUrlKey)+"\x3d"+d}"pagePanel"==b?a+="\x26agent\x3dy":"qrcodePanel"==b&&(a+="\x26agent\x3dn");return a};
IAMCore.prototype._getApplyCaptchaUrl=function(a){var b=new Map,c=encodeURIComponent(Common.Util.getEleValue("account.principalInput",a.settings.account.principalInput));b.set(Common.Util.checkEmpty("definition.principalKey",a.settings.definition.principalKey),c);b.set(Common.Util.checkEmpty("definition.umidTokenKey",a.settings.definition.umidTokenKey),a.runtime.umid.getValue());b.set(Common.Util.checkEmpty("definition.verifyTypeKey",a.settings.definition.verifyTypeKey),Common.Util.checkEmpty("captcha.use",
a.settings.captcha.use));b.set(Common.Util.checkEmpty("definition.responseType",a.settings.definition.responseType),Common.Util.checkEmpty("definition.responseTypeValue",a.settings.definition.responseTypeValue));b.set(Common.Util.checkEmpty("definition.secureAlgKey",a.settings.definition.secureAlgKey),a.runtime.handshake.handleChooseSecureAlg());c=a.getXsrfToken();b.set(c.paramName,c.value);c=a.generateReplayToken();b.set(c.paramName,c.value);a.runtime.handshake.handleSessionTo(b);b.set("r",Math.random());
return Common.Util.checkEmpty("checkCaptcha.applyUri",a.runtime.safeCheck.checkCaptcha.applyUri)+"?"+Common.Util.toUrl({},b)};IAMCore.prototype._getVerifyAnalysisUrl=function(a){var b=new Map,c=encodeURIComponent(Common.Util.getEleValue("account.principalInput",a.settings.account.principalInput));b.set(Common.Util.checkEmpty("definition.principalKey",a.settings.definition.principalKey),c);b.set(Common.Util.checkEmpty("definition.umidTokenKey",a.settings.definition.umidTokenKey),a.runtime.umid.getValue());
b.set(Common.Util.checkEmpty("definition.verifyTypeKey",a.settings.definition.verifyTypeKey),Common.Util.checkEmpty("captcha.use",a.settings.captcha.use));b.set(Common.Util.checkEmpty("definition.responseType",a.settings.definition.responseType),Common.Util.checkEmpty("definition.responseTypeValue",a.settings.definition.responseTypeValue));b.set(Common.Util.checkEmpty("definition.secureAlgKey",a.settings.definition.secureAlgKey),a.runtime.handshake.handleChooseSecureAlg());b.set("r",Math.random());
c=a.getXsrfToken();b.set(c.paramName,c.value);c=a.generateReplayToken();b.set(c.paramName,c.value);a.runtime.handshake.handleSessionTo(b);return Common.Util.checkEmpty("deploy.baseUri",a.settings.deploy.baseUri)+Common.Util.checkEmpty("definition.verifyAnalyzeUri",a.settings.definition.verifyAnalyzeUri)+"?"+Common.Util.toUrl({},b)};IAMCore.prototype._resetCaptcha=function(a){var b=this;a?(a=encodeURIComponent(Common.Util.getEleValue("account.principalInput",b.settings.account.principalInput,!1)),
b._initSafeCheck(a,function(a){b.runtime.safeCheck.checkCaptcha.enabled&&!b.runtime.flags.isCurrentlyApplying&&Common.Util.checkEmpty("captcha.getVerifier",b.settings.captcha.getVerifier)().captchaRender()})):Common.Util.checkEmpty("captcha.getVerifier",b.settings.captcha.getVerifier)().captchaRender()};IAMCore.prototype._snsViewReader=function(a,b){if("qrcodePanel"==b){var c=p.querySelector("#iam_qrcode_panel_iframe");if(null==c||0>=c.length){c=Common.Util.checkEmpty("sns.qrcodePanel",this.settings.sns.qrcodePanel);
b=Common.Util.checkEmpty("qrcodePanel.src",c.src);var d=c.width||"250",e=c.height||"260",c=p.createElement("iframe");c.setAttribute("id","iam_qrcode_panel_iframe");c.setAttribute("frameborder","1");c.setAttribute("scrolling","no");c.setAttribute("width",d);c.setAttribute("height",e);c.setAttribute("style","border:solid 0;");b.appendChild(c)}setTimeout(function(){var b=p.querySelector("#iam_qrcode_panel_iframe");-1==navigator.userAgent.indexOf("MSIE")?b.src=a:b.location=a},2)}else if("pagePanel"==
b){b=Common.Util.checkEmpty("sns.pagePanel",this.settings.sns.pagePanel);var g=n.open(a,n,"modal\x3d"+(b.modal||"yes")+",width\x3d"+(b.width||"800px")+",height\x3d"+(b.height||"500px")+",resizable\x3d"+(b.resizable||"no")+",left\x3d"+(b.left||"250px")+",top\x3d"+(b.top||"100px")),f=setInterval(function(){var a=n.document.getElementsByTagName("body")[0].getAttribute("refreshUrl");null!=g&&g.closed&&(clearInterval(f),Common.Util.isEmpty(a)||(Common.Util.getRootWindow(n).location.href=a))},200)}else throw"Unsupported panelType, use 'qrcodePanel' or 'pagePanel'";
};IAMCore.prototype._initSNSAuthenticator=function(){var a=this;if(a.settings.sns.enable){var b=Common.Util.checkEmpty("sns.provider",a.settings.sns.provider),c;for(c in b){var d=b[c],e=Common.Util.checkEmpty(c+".src",d.src),d=Common.Util.checkEmpty(c+".panelType",d.panelType);e.setAttribute("provider",c);e.setAttribute("panelType",d);e.onclick=function(b){var c=b.srcElement;b=c.getAttribute("provider");var c=c.getAttribute("panelType"),d=_getSnsConnectUrl(b,c);if(!a.settings.sns.onBefore(b,c,d))return console.warn("onBefore has blocked execution"),
this;_snsViewReader(d,c)}}}else IAMCore.Console.debug("SNS authenticator not enable!")};IAMCore.prototype._initSafeCheck=function(a,b){var c=this;$(function(){b||(b=a,a="");if(Common.Util.checkEmpty("init.onPreCheck",c.settings.init.onPreCheck)(a)){var d=new Map;d.set("{principalKey}",a);d.set("{verifyTypeKey}",Common.Util.checkEmpty("captcha.use",c.settings.captcha.use));d.set("{umidTokenKey}",c.runtime.umid.getValue());d.set("{secureAlgKey}",c.runtime.handshake.handleChooseSecureAlg());c._doIamRequest("post",
"{checkUri}",d,function(a){Common.Util.checkEmpty("init.onPostCheck",c.settings.init.onPostCheck)(a);var d=Common.Util.checkEmpty("definition.codeOkValue",c.settings.definition.codeOkValue);Common.Util.isEmpty(a)||a.code!=d||(c.runtime.safeCheck=$.extend(!0,c.runtime.safeCheck,a.data),b(a))},function(a){IAMCore.Console.log("Failed to safe check, "+a);Common.Util.checkEmpty("init.onError",c.settings.init.onError)(a)},null,!0)}else console.warn("Skip the init safeCheck, because onPreCheck() return false")})};
IAMCore.prototype._initCaptchaVerifier=function(){var a=this;a.settings.captcha.enable?$(function(){a._resetCaptcha(!0);if("VerifyWithSimpleGraph"==a.settings.captcha.use||"VerifyWithGifGraph"==a.settings.captcha.use){var b=$(Common.Util.checkEmpty("captcha.input",a.settings.captcha.input));b.attr("maxlength",Common.Util.checkEmpty("captcha.getVerifier",a.settings.captcha.getVerifier)().captchaLen);b.keyup(function(){if(a.runtime.safeCheck.checkCaptcha.enabled){var c=b.val();if(!Common.Util.isEmpty(c)&&
c.length>=parseInt(b.attr("maxlength"))&&!a.runtime.flags.isVerifying){a.runtime.flags.isVerifying=!0;var d=new Map;d.put("{verifyDataKey}",c);d.put("{applyTokenKey}",Common.Util.checkEmpty("applyModel.applyToken",a.runtime.applyModel.applyToken));d.put("{verifyTypeKey}",Common.Util.checkEmpty("applyModel.verifyType",a.runtime.applyModel.verifyType));d.set("{umidTokenKey}",a.runtime.umid.getValue());a._doIamRequest("post",_getVerifyAnalysisUrl(a),d,function(b){a.runtime.flags.isVerifying=!1;var c=
Common.Util.checkEmpty("definition.codeOkValue",a.settings.definition.codeOkValue);Common.Util.isEmpty(b)||b.code==c?(a.runtime.verifiedModel=b.data.verifiedModel,Common.Util.checkEmpty("captcha.getVerifier",a.settings.captcha.getVerifier)().captchaDestroy(!1)):(_resetCaptcha(!0),a.settings.captcha.onError(b.message))},function(b){a.runtime.flags.isVerifying=!1;_resetCaptcha(!0);a.settings.captcha.onError(b)},null,!0)}}})}}):IAMCore.Console.debug("Captcha verifier not enable!")};IAMCore.prototype._initAccountAuthenticator=
function(){var a=this;a.settings.account.enable?$(function(){$(p).bind("keydown",function(b){13==b.keyCode&&$(Common.Util.checkEmpty("account.submitBtn",a.settings.account.submitBtn)).click()});$(Common.Util.checkEmpty("account.submitBtn",a.settings.account.submitBtn)).click(function(){var b=encodeURIComponent(Common.Util.getEleValue("account.principalInput",a.settings.account.principalInput)),c=Common.Util.getEleValue("account.credentialInput",a.settings.account.credentialInput);if(Common.Util.isAnyEmpty(b,
c))a.settings.account.onError(Common.Util.isZhCN()?"请输入账户名和密码":"Please input your account and password");else a._initHandshakeIfNecessary(!0).then(function(d){a._initSafeCheck(b,function(d){a.runtime.clientSecretKey=IAMCrypto.RSA.generateKey();d=Common.Util.checkEmpty("Secret is required",a.runtime.safeCheck.checkGeneric.secretKey);d=encodeURIComponent(IAMCrypto.RSA.encryptToHexString(d,c));var e="";if(a.runtime.safeCheck.checkCaptcha.enabled&&(e=a.runtime.verifiedModel.verifiedToken,Common.Util.isEmpty(e))){a.settings.account.onError(Common.Util.isZhCN()?
"请完成人机验证":"Please complete man-machine verify");_resetCaptcha(!1);return}if(Common.Util.isAnyEmpty(b,d))a.settings.account.onError("No empty login name or password allowed");else if(a.settings.account.onBeforeSubmit(b,d,e)){$(Common.Util.checkEmpty("account.submitBtn",a.settings.account.submitBtn)).attr("disabled",!0);var f=new Map;f.set("{principalKey}",b);f.set("{credentialKey}",d);f.set("{clientSecretKey}",a.runtime.clientSecretKey.publicKeyHex);f.set("{clientRefKey}",a._getClientRef());f.set("{verifiedTokenKey}",
e);f.set("{verifyTypeKey}",Common.Util.checkEmpty("captcha.use",a.settings.captcha.use));f.set("{secureAlgKey}",a.runtime.handshake.handleChooseSecureAlg());f.set("{umidTokenKey}",a.runtime.umid.getValue());Common.Util.mergeMap(a.settings.account.customParamMap,f);a._doIamRequest("post","{accountSubmitUri}",f,function(c){$(Common.Util.checkEmpty("account.submitBtn",a.settings.account.submitBtn)).removeAttr("disabled");a.runtime.verifiedModel.verifiedToken="";var d=Common.Util.checkEmpty("definition.codeOkValue",
a.settings.definition.codeOkValue);Common.Util.isEmpty(c)||c.code==d?($(p).unbind("keydown"),d=Common.Util.checkEmpty("Login successfully, response data.redirect_url is empty",c.data[a.settings.definition.redirectUrlKey]),a.settings.account.onSuccess(b,c.data)&&(Common.Util.getRootWindow(n).location.href=d)):(a._resetCaptcha(!0),a.settings.account.onError(c.message))},function(b){$(Common.Util.checkEmpty("account.submitBtn",a.settings.account.submitBtn)).removeAttr("disabled");a.runtime.verifiedModel.verifiedToken=
"";a.settings.account.onError(b)},null,!0)}})})})}):IAMCore.Console.debug("Account authenticator not enable!")};IAMCore.prototype._initSMSAuthenticator=function(){var a=this;a.settings.sms.enable?$(function(){$(Common.Util.checkEmpty("sms.sendSmsBtn",a.settings.sms.sendSmsBtn)).click(function(){var b=Common.Util.getEleValue("sms.mobileArea",a.settings.sms.mobileArea,!1)+Common.Util.getEleValue("sms.mobile",a.settings.sms.mobile,!1);if(Common.Util.isEmpty(b))a.settings.sms.onError("SMS login for mobile number is required.");
else{var c=$(Common.Util.checkEmpty("captcha.input",a.settings.captcha.input)),g=c.val();if(a.runtime.safeCheck.captchaEnabled&&(Common.Util.isEmpty(g)||g.length<c.attr("maxlength")))a.settings.account.onError("Illegal length of captcha input");else c=new Map,c.set("{principalKey}",encodeURIComponent(b)),c.set("{verifiedTokenKey}",g),a._doIamRequest("post","{smsApplyUri}",c,function(b){var c=Common.Util.checkEmpty("definition.codeOkValue",a.settings.definition.codeOkValue);if(Common.Util.isEmpty(b)||
b.code==c){a.settings.sms.onSuccess(b);var d=parseInt(b.data.checkSms.remainDelayMs/1E3),e=setInterval(function(){var b=$(a.settings.sms.sendSmsBtn);1>d?(b.attr("disabled",!1),b.text("获取"),clearInterval(e)):(b.attr("disabled",!0),b.text(d+"s"),d--)},1E3)}else a.settings.sms.onError(b.message)},function(b){a.settings.sms.onError(b)},null,!0)}});$(Common.Util.checkEmpty("sms.submitBtn",a.settings.sms.submitBtn)).click(function(){var b=Common.Util.getEleValue("sms.mobileArea",a.settings.sms.mobileArea,
!1)+Common.Util.getEleValue("sms.mobile",a.settings.sms.mobile,!1),c=Common.Util.getEleValue("sms.smsCode",a.settings.sms.smsCode,!1);if(a.settings.sms.onBeforeSubmit(b,c)){var g=new Map;g.set("{principalKey}",encodeURIComponent(b));g.set("{credentialKey}",c);g.set("{smsActionKey}",Common.Util.checkEmpty("definition.smsActionValueLogin",a.settings.definition.smsActionValueLogin));a._doIamRequest("post","{smsSubmitUri}",g,function(b){var c=Common.Util.checkEmpty("definition.codeOkValue",a.settings.definition.codeOkValue);
if(Common.Util.isEmpty(b)||b.code==c)a.settings.sms.onSuccess(b),Common.Util.getRootWindow(n).location.href=b.data.redirect_url;else a.settings.sms.onError(b.message)},function(b){a.settings.sms.onError(b)},null,!0)}});if(a.runtime.safeCheck.checkSms.enabled){$(a.settings.sms.mobile).val(a.runtime.safeCheck.checkSms.mobileNum);var b=parseInt(a.runtime.safeCheck.checkSms.remainDelayMs/1E3),c=setInterval(function(){var d=$(a.settings.sms.sendSmsBtn);if(1>b){d.attr("disabled",!1);var e="新获取验证码";Common.Util.isZhCN()||
(e="Get verify code");d.text(e);clearInterval(c)}else d.attr("disabled",!0),d.text(b+"s"),b--},1E3)}}):IAMCore.Console.debug("SMS authenticator not enable!")};IAMCore.prototype._getClientRef=function(){var a=null,b=Common.Util.PlatformType,c;for(c in b)if(b[c]){IAMCore.Console.debug("Got current OS: "+c);a=c;break}Common.Util.isEmpty(a)&&(a="Unknown",console.warn("Unknown platform browser ["+navigator.appVersion+"]"));return a};IAMCore.prototype._doIamRequest=function(a,b,c,d,e,g,f){Common.Util.isMap(c)?
c.set("{responseType}",Common.Util.checkEmpty("definition.responseTypeValue",this.settings.definition.responseTypeValue)):Common.Util.isObject(c)&&(c.responseType=Common.Util.checkEmpty("definition.responseTypeValue",this.settings.definition.responseTypeValue));f&&this.runtime.handshake.handleSessionTo(c);f=null;b.startsWith("@")?f=b.substring(b.indexOf("@")+1):(f=Common.Util.checkEmpty("deploy.baseUri",this.settings.deploy.baseUri),b.startsWith("{")&&b.endsWith("}")&&(b=b.substr(1,b.length-2)),f+=
Common.Util.checkEmpty("definition",this.settings.definition[b]));b=new Map;if("POST"==a.toUpperCase()||"DELETE"==a.toUpperCase()){var k=this.getXsrfToken();b.set(k.headerName,k.value);k=this.generateReplayToken();b.set(k.headerName,k.value)}c=Common.Util.isMap(c)?Common.Util.toUrl(this.settings.definition,c):c;IAMCore.Console.debug("Requesting for - url:",f,"headers:",b);$.ajax({url:f,type:a,async:!0,headers:JSON.fromMap(b),data:c,xhrFields:{withCredentials:!0},success:function(a,b,c){d&&d(a)},error:function(a,
b,c){e&&e(c)},complete:function(a){g&&g(a)}})};IAMCore.WindowFacade=function(a){var b=this;this.iamCore=a;this.props={cache:{bodyStyle:null,bodyClass:null},hideDocumentAndOpenLoading:function(){var a=b.props,d=$("body");a.cache.bodyStyle=d.attr("style");a.cache.bodyClass=d.attr("class");d.removeAttr("style");d.removeAttr("class");0>=$(".iam_check_authc_redirect_style").length&&$("\x3cstyle class\x3d'iam_check_authc_redirect_style'\x3ediv,img,span,p,a,b{display:none;}body{background:url("+l.resources.loading+
") no-repeat;background-position:center;!important}\x3c/style\x3e").appendTo($("head"))},showDocumentAndCloseLoading:function(){var a=b.props,d=$("body");a.cache.bodyStyle&&d.attr("style",a.cache.bodyStyle);a.cache.bodyClass&&d.attr("class",a.cache.bodyClass);$(".iam_check_authc_redirect_style").remove()},doHandle:function(a){if(Common.Util.isEmpty(a))throw Error("Parameter 'redirectUrl' is required!");IAMCore.Console.info("Checking unauthenticated and redirection ... ");var c=b.props;c.hideDocumentAndOpenLoading();
$(function(){c.hideDocumentAndOpenLoading()});return new Promise(function(d){var e=b.iamCore;IAMCore.Console.info("Checking authentication state ...");e._initHandshakeIfNecessary(!0).then(function(b){if(e.checkRespUnauthenticated(b))IAMCore.Console.info("Unauthentication rendering login page ... "),setTimeout(function(){c.showDocumentAndCloseLoading();sessionStorage.removeItem(l.authRedirectRecordStorageKey);d(b)},200+parseInt(2E3*Math.random()));else{var f=JSON.parse(sessionStorage.getItem(l.authRedirectRecordStorageKey));
if(!f||f&&1E4<Math.abs((new Date).getTime()-f.t))sessionStorage.removeItem(l.authRedirectRecordStorageKey),f={c:0,t:(new Date).getTime()};if(10<f.c)throw"Too many failure redirections: "+f.c;++f.c;f.t=(new Date).getTime();sessionStorage.setItem(l.authRedirectRecordStorageKey,JSON.stringify(f));IAMCore.Console.info("Authenticated and redirection to: ",a);setTimeout(function(){n.location=a},200+parseInt(500*Math.random()))}})})}}};IAMCore.WindowFacade.prototype.initFor=function(a){if(Common.Util.isEmpty(a))throw Error("Parameter 'iamCore' is required!");
this.iamCore=a;return this};IAMCore.WindowFacade.getInstance=function(){var a;return function(){return a?a:a=new IAMCore.WindowFacade}}();IAMCore.prototype._initHandshakeIfNecessary=function(a){var b=this;return this.runtime.umid.getValuePromise().then(function(c){return b.runtime.handshake.getValuePromise(c,a)})};IAMCore.prototype.getUMToken=function(){return this.runtime.umid.getValue()};IAMCore.prototype.safeCheck=function(a,b,c){var d=this;this._initHandshakeIfNecessary(c).then(function(c){d._initSafeCheck(a,
b)});return this};IAMCore.prototype.anyAuthenticators=function(){return this.accountAuthenticator().smsAuthenticator().snsAuthenticator().captchaVerifier()};IAMCore.prototype.accountAuthenticator=function(){this.settings.account.enable=!0;return this};IAMCore.prototype.smsAuthenticator=function(){this.settings.sms.enable=!0;return this};IAMCore.prototype.snsAuthenticator=function(){this.settings.sns.enable=!0;return this};IAMCore.prototype.captchaVerifier=function(){this.settings.captcha.enable=!0;
return this};IAMCore.prototype.bind=function(){var a=this;IAMCore.Console.info("IAMCore initializing binding ...");a._initHandshakeIfNecessary(!0).then(function(b){a._initAccountAuthenticator();a._initSMSAuthenticator();a._initSNSAuthenticator();a._initCaptchaVerifier()})};IAMCore.prototype.destroy=function(){for(var a in l)sessionStorage.removeItem(l[a]);l=this.settings=this.runtime=this._defaultCaptchaVerifier=null;IAMCore.Console.log("Destroyed IAMCore instance.")};IAMCore.prototype.checkAuthenticationAndRedirect=
function(a){return IAMCore.WindowFacade.getInstance().initFor(this).props.doHandle(a)};IAMCore.prototype.multiModularMutexAuthenticatingHandler=function(a,b,c,d,e,g,f){return this._multiModularAuthenticatingHandler().doHandle(a,b,c,d,e,g,f)}})(window,document);